activate () {
    if [[ -z $VENV_DIR ]]; then
        echo "Please set the VENV_DIR variable."
        return
    elif [[ -z $1 ]]; then
        echo "Usage: activate <virtualenvname>"
        return
    elif [[ ! -d $VENV_DIR/$1 ]]; then
        echo "No virtual environment named $1"
        return
    fi

    source $VENV_DIR/$1/bin/activate
}

browser () {
    f=$(mktemp --suffix=.html)
    cat /dev/stdin > $f
    xdg-open $f &> /dev/null
}

cmake-build ()
{
    cmake -G Ninja \
          -DCMAKE_BUILD_TYPE=RelWithDebInfo \
          -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
          -DCMAKE_CXX_COMPILER=clang++ \
          -DCMAKE_C_COMPILER=clang \
          "$@" \
          ..
}

destroy ()
{
    if [[ ! -z $1 ]]; then
        rm -rf $1; mkdir $1; cd $1
    fi
}

distro () {
    if [ -e /etc/SUSE-brand ]; then
        echo "SUSE"
    elif [ -e /etc/debian_version ]; then
        echo "DEBIAN"
    elif [ -e /etc/redhat-release ]; then
        echo "REDHAT"
    fi
}

find-broken-symlinks () {
    find -L $1 -type l -exec ls -lF --color=yes '{}' +
}

ftrace () {
    strace -f -e trace=file $@
}

gpg-refresh-agent-tty () {
    gpg-connect-agent <<< "UPDATESTARTUPTTY" > /dev/null
}

i ()
{
    if [[ ! -z $1 && -d $1 ]]; then
        PATH=$1:$PATH
        export -U PATH
        exec zsh -l
    fi
}

installpkg () {
    dist=$(distro)
    case $dist in
        SUSE)
            sudo zypper in "$@"
            ;;
        DEBIAN)
            sudo apt-get install "$@"
            ;;
        REDHAT)
            sudo yum install "$@"
            ;;
    esac
}

removepkg () {
    dist=$(distro)
    case $dist in
        SUSE)
            sudo zypper rm -u "$@"
            ;;
        DEBIAN)
            sudo apt-get --purge remove "$@"
            ;;
        REDHAT)
            sudo yum remove "$@"
            ;;
    esac
}

searchpkg () {
    dist=$(distro)
    case $dist in
        SUSE)
            sudo zypper search "$@"
            ;;
        DEBIAN)
            sudo apt-cache search "$@"
            ;;
        REDHAT)
            sudo yum search "$@"
            ;;
    esac
}

upup () {
    dist=$(distro)
    case $dist in
        SUSE)
            sudo zypper ref && sudo zypper dup --auto-agree-with-licenses
            ;;
        DEBIAN)
            sudo apt-get update && sudo apt-get dist-upgrade
            ;;
        REDHAT)
            sudo yum update
            ;;
    esac
}
